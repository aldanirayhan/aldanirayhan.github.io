<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Voucher Scanner</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="wrapper slide-in">
      <h2>
        <span style="background: #000; color: #fff; padding: 0.2em 0.4em"
          >QR Voucher Scanner</span
        >
      </h2>

      <div id="reader"></div>

      <div id="scan-frame">
        <div class="corner tl">~</div>
        <div class="corner tr">~</div>
        <p>Izinkan kamera untuk memindai kode QR dari voucher bukomar.net</p>
        <div class="corner bl">~</div>
        <div class="corner br">~</div>
      </div>

      <button id="start-scan">ðŸ“· Mulai Scan dengan kamera</button>
      <button id="stop-scan">â›” Berhenti Scan</button>

      <p class="copy-right">Â© 2025 <a href="#">Warung Bu Komar</a> âš¡</p>
    </div>

    <script>
      const html5QrCode = new Html5Qrcode('reader');
      const reader = document.getElementById('reader');
      const startBtn = document.getElementById('start-scan');
      const stopBtn = document.getElementById('stop-scan');
      const fileInput = document.getElementById('qr-file');
      const scanFrame = document.getElementById('scan-frame');

      startBtn.addEventListener('click', async () => {
        const cameras = await Html5Qrcode.getCameras();
        if (cameras && cameras.length) {
          reader.style.display = 'block';
          scanFrame.style.display = 'none'; // sembunyikan frame
          // Prioritaskan kamera belakang kalau ada
          const backCam = cameras.find((cam) =>
            cam.label.toLowerCase().includes('back')
          );
          const cameraId = backCam ? backCam.id : cameras[0].id;

          html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: 250 },
            (decodedText) => {
              window.location.href = decodedText;
              html5QrCode.stop();
            },
            (error) => console.log(error)
          );
          startBtn.style.display = 'none';
          stopBtn.style.display = 'inline-block';
        }
      });

      stopBtn.addEventListener('click', () => {
        html5QrCode.stop().then(() => {
          reader.style.display = 'none';
          scanFrame.style.display = 'block'; // tampilkan frame lagi
          startBtn.style.display = 'inline-block';
          stopBtn.style.display = 'none';
        });
      });
    </script>
  </body>
</html>
